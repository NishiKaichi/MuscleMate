{% extends "layout_login.html" %}

{% block title %}
  {{ user_info['username'] }}さんの筋トレページ
{% endblock %}

{% block contents %}
<div style="text-align: center;">
  {{ user_info['username'] }}さんの筋トレページ
</div>

<!-- プロフィール画像の表示 -->
<div class="profile-section" style="text-align: center; margin-bottom: 20px;">
    {% if user_info.profile_image %}
        <img src="{{ url_for('static', filename='uploads/' ~ user_info.profile_image) }}" alt="プロフィール画像" class="profile-image">
    {% else %}
        <img src="{{ url_for('static', filename='uploads/default.png') }}" alt="デフォルトプロフィール画像" class="profile-image">
    {% endif %}
    <div>{{ user_info.username }}</div>
    
    <!-- プロフィール画像の編集（自分のプロフィールページのみ表示） -->
    {% if user_info.id == current_user_id %}
    <form action="/upload_profile_image" method="POST" enctype="multipart/form-data" style="margin-top: 10px;">
        <label for="profile_image">プロフィール画像をアップロード:</label>
        <input type="file" name="profile_image" id="profile_image">
        <button type="submit" class="pure-button pure-button-primary">アップロード</button>
    </form>
    {% endif %}
</div>

{% if user_info['id'] != current_user_id %}
<div class="box_userpage">
  {% if is_fav %}
  <form action="/remove_fav/{{ user_info['id'] }}" method="POST">
    <button type="submit" class="pure-button">お気に入り解除</button>
  </form>
  {% else %}
    <form action="/add_fav/{{ user_info['id'] }}" method="POST">
    <button type="submit" class="pure-button">お気に入り追加</button>
  </form>
  {% endif %}
</div>
{% endif %}

<h3>投稿</h3>

{% if posts | length == 0 %}
  <div style="text-align: center;">
  投稿はまだありません。
  </div>
{% else %}
<div id="TimeLine">
  <div class="post-list">
    {% for post in posts %}
      <div class="post">
        {{ post.content | linebreaks }}
        <p>カテゴリ: {{ post.category}}</p>
        {% if post.image_path %}
        <br><img src="{{ url_for('static', filename='uploads/' ~ post.image_path) }}" alt="Image">
        {% endif %}
        <p class="info">{{ post.timestamp | datestr }}</p>
        <form action="/toggle_like/{{ post.id }}" method="post" style="display:inline;">
          {% if post.liked_by_me %}
          <button type="submit">いいねを取り消す</button>
          {% else %}
          <button type="submit">いいね</button>
          {% endif %}
        </form>
        <span>{{ post.like_count }} いいね</span>
        <!-- 削除ボタンの追加 -->
        {% if post.user_id == user_id %}
          <form action="/delete_post/{{ post.id }}" method="post" style="display:inline;">
            <button type="submit" onclick="return confirm('本当にこの投稿を削除しますか？')">削除</button>
          </form>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>
{% endif %}

{% endblock %}

